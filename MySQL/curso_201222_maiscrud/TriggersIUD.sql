CREATE TABLE TB_FATURAMENTO(
	DATA_VENDA DATE NULL,
    TOTAL_VENDA FLOAT
);

DELETE FROM itens_notas;
DELETE FROM notas;
SELECT * FROM notas;
SELECT * FROM itens_notas;
SELECT * FROM TB_FATURAMENTO;

INSERT INTO notas
VALUES(100, CURDATE(), '1471156710', 235, 0.10);

INSERT INTO itens_notas
VALUES(100, 1000889, 100, 10),
		(100, 1002334, 100, 10);
        
INSERT INTO notas
VALUES(101, CURDATE(), '1471156710', 235, 0.10);

INSERT INTO itens_notas
VALUES(101, 1000889, 100, 10),
		(101, 1002334, 100, 10);
        
INSERT INTO notas
VALUES(102, CURDATE(), '1471156710', 235, 0.10);

INSERT INTO itens_notas
VALUES(102, 1000889, 100, 10),
		(102, 1002334, 100, 10);

INSERT INTO notas
VALUES(103, CURDATE(), '1471156710', 235, 0.10);
        
INSERT INTO itens_notas
VALUES(103, 1000889, 100, 10),
		(103, 1002334, 100, 10);
        
INSERT INTO notas
VALUES(104, CURDATE(), '1471156710', 235, 0.10);
        
INSERT INTO itens_notas
VALUES(104, 1000889, 100, 10),
		(104, 1002334, 100, 10);
        
INSERT INTO notas
VALUES(105, CURDATE(), '1471156710', 235, 0.10);
        
INSERT INTO itens_notas
VALUES(105, 1000889, 100, 10),
		(105, 1002334, 100, 10);
        
INSERT INTO TB_FATURAMENTO
SELECT
	A.data_venda,
	SUM(B.quantidade * B.preco)
FROM
	notas A
INNER JOIN itens_notas B
ON A.numero = B.numero
GROUP BY A.data_venda;

DELIMITER $$
CREATE TRIGGER TG_CALCULA_FATURAMENTO_INSERT AFTER INSERT ON itens_notas
FOR EACH ROW BEGIN
	DELETE FROM TB_FATURAMENTO;
	INSERT INTO TB_FATURAMENTO
	SELECT
		A.data_venda,
		SUM(B.quantidade * B.preco)
	FROM
		notas A
INNER JOIN itens_notas B
ON A.numero = B.numero
GROUP BY A.data_venda;
END$$
DELIMITER ;

DELIMITER $$
CREATE TRIGGER TG_CALCULA_FATURAMENTO_UPDATE AFTER UPDATE ON itens_notas
FOR EACH ROW BEGIN
	DELETE FROM TB_FATURAMENTO;
	INSERT INTO TB_FATURAMENTO
	SELECT
		A.data_venda,
		SUM(B.quantidade * B.preco)
	FROM
		notas A
INNER JOIN itens_notas B
ON A.numero = B.numero
GROUP BY A.data_venda;
END$$
DELIMITER ;

DELIMITER $$
CREATE TRIGGER TG_CALCULA_FATURAMENTO_DELETE AFTER DELETE ON itens_notas
FOR EACH ROW BEGIN
	DELETE FROM TB_FATURAMENTO;
	INSERT INTO TB_FATURAMENTO
	SELECT
		A.data_venda,
		SUM(B.quantidade * B.preco)
	FROM
		notas A
INNER JOIN itens_notas B
ON A.numero = B.numero
GROUP BY A.data_venda;
END$$
DELIMITER ;